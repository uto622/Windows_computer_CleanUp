https://chatgpt.com/canvas/shared/68233755ba4c8191912997ae93dff119

:: âœ… SETUP_AI_ENV.BAT â€” å…¨è‡ªå‹• AI ç’°å¢ƒæ­å»ºè…³æœ¬ for D: Drive
:: ä½œè€…ï¼šChatGPTï¼ˆç‚ºç”¨æˆ¶å®šåˆ¶ï¼‰

@echo off
setlocal EnableDelayedExpansion

:: === ç”¨æˆ¶å®šç¾©è®Šæ•¸ ===
set PYTHON_DIR=D:\AI\Python310
set VENV_DIR=D:\AI\envs\venv_ai
set COMFY_DIR=D:\AI\ComfyUI
set MODEL_DIR=D:\AI\models
set TEMP_DIR=D:\AI\tmp
set CHECKPOINT_DIR=%COMFY_DIR%\models\checkpoints

:: === å‰µå»ºç›®éŒ„çµæ§‹ ===
echo âœ… å»ºç«‹è³‡æ–™å¤¾...
mkdir "%PYTHON_DIR%"
mkdir "%VENV_DIR%"
mkdir "%COMFY_DIR%"
mkdir "%MODEL_DIR%"
mkdir "%TEMP_DIR%"
mkdir "%CHECKPOINT_DIR%"
mkdir "%MODEL_DIR%\torch_cache"
mkdir "D:\AI\logs"

:: === å®‰è£ Python 3.10 åˆ° D ç›¤ï¼ˆéœ€æ‰‹å‹•ä¸‹è¼‰å®‰è£å™¨ï¼‰ ===
echo âœ… è«‹ä¸‹è¼‰ python-3.10.x-amd64.exe ä¸¦å®‰è£è‡³: %PYTHON_DIR%
echo âœ… å‹™å¿…å‹¾é¸ Add to PATHï¼Œæˆ–å®‰è£å¾Œå†æ‰‹å‹•è¨­ç½® PATH
pause

:: === å»ºç«‹è™›æ“¬ç’°å¢ƒä¸¦å•Ÿç”¨ ===
echo âœ… å»ºç«‹è™›æ“¬ç’°å¢ƒ...
"%PYTHON_DIR%\python.exe" -m venv "%VENV_DIR%"
call "%VENV_DIR%\Scripts\activate.bat"

:: === å®‰è£ PyTorch (CUDA 11.8) èˆ‡ TensorFlow (GPU) ===
echo âœ… å®‰è£ PyTorch & TensorFlow...
pip install --upgrade pip
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118
pip install tensorflow

:: === å®‰è£ xformersï¼ˆæå‡æ¨ç†æ•ˆç‡ï¼‰ ===
echo âœ… å®‰è£ xformers...
pip install xformers --index-url https://download.pytorch.org/whl/cu118

:: === ä¸‹è¼‰èˆ‡å®‰è£ ComfyUI ===
echo âœ… ä¸‹è¼‰ ComfyUI...
cd /d D:\AI
git clone https://github.com/comfyanonymous/ComfyUI.git ComfyUI
cd ComfyUI
call "%VENV_DIR%\Scripts\activate.bat"
pip install -r requirements.txt

:: === å®‰è£ ComfyUI æ’ä»¶ç¯€é» ===
echo âœ… å®‰è£ ComfyUI plugins...
cd "%COMFY_DIR%\custom_nodes"
git clone https://github.com/Fannovel16/comfyui_controlnet_aux.git
pip install -r comfyui_controlnet_aux/requirements.txt

git clone https://github.com/Kosinkadink/ComfyUI-Advanced-ControlNet.git

git clone https://github.com/ltdrdata/ComfyUI-Manager.git

:: === è‡ªå‹•ä¸‹è¼‰ SD1.5 æ¨¡å‹ ===
echo âœ… ä¸‹è¼‰ SD1.5 æ¨¡å‹åˆ° checkpoints...
curl -L -o "%CHECKPOINT_DIR%\v1-5-pruned-emaonly.ckpt" https://huggingface.co/runwayml/stable-diffusion-v1-5/resolve/main/v1-5-pruned-emaonly.ckpt

:: === è¨­å®š TEMP èˆ‡å¿«å–é‡å®šå‘ ===
echo âœ… è¨­å®š TEMPã€PyTorch å¿«å–èˆ‡æ¨¡å‹è·¯å¾‘...
setx TEMP "%TEMP_DIR%" /M
setx TMP "%TEMP_DIR%" /M
setx TORCH_HOME "%MODEL_DIR%\torch_cache" /M

:: === å»ºç«‹è¼¸å‡ºèˆ‡ç·©å­˜ç›®éŒ„ ===
mkdir "%COMFY_DIR%\output"
mkdir "%COMFY_DIR%\temp"

:: === ç”¢å‡º GPU æ¸¬è©¦è…³æœ¬ gpu_test.py ===
echo âœ… ç”¢å‡º gpu_test.py...
echo import torch> gpu_test.py
echo print("torch.cuda.is_available():", torch.cuda.is_available())>> gpu_test.py
echo print("cuDNN available:", torch.backends.cudnn.is_available())>> gpu_test.py
echo import tensorflow as tf>> gpu_test.py
echo print("tf.config.list_physical_devices:", tf.config.list_physical_devices('GPU'))>> gpu_test.py

:: === åŸ·è¡Œæ¸¬è©¦ ===
echo âœ… å•Ÿå‹• GPU æ¸¬è©¦...
python gpu_test.py

:: === æ¸…ç†å ±å‘Šè…³æœ¬ ===
echo âœ… ç”¢å‡º cleanup_report.bat...
echo @echo off> cleanup_report.bat
echo echo å‰ç£ç¢Ÿç©ºé–“ï¼š>> cleanup_report.bat
echo wmic logicaldisk get size,freespace,caption>> cleanup_report.bat
echo echo æ¸…ç† ComfyUI å¿«å–èˆ‡ TEMP...>> cleanup_report.bat
echo del /f /q "%COMFY_DIR%\output\*.*">> cleanup_report.bat
echo del /f /q "%COMFY_DIR%\temp\*.*">> cleanup_report.bat
echo del /f /q "%TEMP_DIR%\*.*">> cleanup_report.bat
echo echo å¾Œç£ç¢Ÿç©ºé–“ï¼š>> cleanup_report.bat
echo wmic logicaldisk get size,freespace,caption>> cleanup_report.bat

:: === çµæŸæç¤º ===
echo âœ… å…¨éƒ¨å®‰è£å®Œæˆï¼
echo ğŸ”§ åŸ·è¡Œ cleanup_report.bat å¯æ¸…å¿«å–ä¸¦è§€å¯Ÿç£ç¢Ÿè®ŠåŒ–
pause
exit
